<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>لوحة تحكم متجر التطبيقات</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 20px;
      background: #f7f7f7;
      color: #222;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    form {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: 700;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
      font-family: 'Cairo', sans-serif;
    }
    textarea {
      resize: vertical;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      background-color: #004225;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #036b1c;
    }
    table {
      width: 100%;
      max-width: 900px;
      margin: 30px auto 0;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
      font-size: 14px;
    }
    th {
      background-color: #004225;
      color: #fff;
      font-weight: 700;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .action-btn {
      background-color: #d9534f;
      border: none;
      color: white;
      padding: 5px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 700;
      margin: 0 2px;
    }
    .edit-btn {
      background-color: #0275d8;
    }
  </style>
</head>
<body>

<h2>لوحة تحكم متجر التطبيقات</h2>

<form id="appForm">
  <input type="hidden" id="appId" value="" />
  <label for="name">اسم التطبيق / اللعبة:</label>
  <input type="text" id="name" required />

  <label for="image">رابط صورة التطبيق / اللعبة:</label>
  <input type="url" id="image" required />

  <label for="link">رابط تحميل التطبيق / اللعبة:</label>
  <input type="url" id="link" required />

  <label for="type">النوع:</label>
  <select id="type" required>
    <option value="" disabled selected>اختر النوع</option>
    <option value="app">تطبيق</option>
    <option value="game">لعبة</option>
  </select>

  <label for="details">تفاصيل التطبيق / اللعبة:</label>
  <textarea id="details" rows="4" required></textarea>

  <button type="submit">حفظ</button>
</form>

<table>
  <thead>
    <tr>
      <th>الاسم</th>
      <th>الصورة</th>
      <th>النوع</th>
      <th>رابط التحميل</th>
      <th>الإجراءات</th>
    </tr>
  </thead>
  <tbody id="appsTableBody">
    <!-- هنا تظهر التطبيقات والألعاب -->
  </tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // إعداد Firebase (استبدل بالقيم الخاصة بك)
  const firebaseConfig = {
    apiKey: "AIzaSyA7AG0srgNst24Fk9qrEQWCRrhYxZvpvF0",
    authDomain: "alfaham-app.firebaseapp.com",
    databaseURL: "https://alfaham-app-default-rtdb.firebaseio.com/",
    projectId: "alfaham-app",
    storageBucket: "alfaham-app.appspot.com",
    messagingSenderId: "835691696342",
    appId: "1:835691696342:web:7998e7a6c7d024ba287977"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const form = document.getElementById("appForm");
  const appsTableBody = document.getElementById("appsTableBody");

  // تحميل البيانات وعرضها
  function loadApps() {
    db.ref('items').on('value', snapshot => {
      appsTableBody.innerHTML = "";
      const data = snapshot.val();
      if(data){
        Object.keys(data).forEach(id => {
          const item = data[id];
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${item.name}</td>
            <td><img src="${item.image}" alt="${item.name}" width="50" height="50" style="border-radius:6px;" /></td>
            <td>${item.type === 'app' ? 'تطبيق' : 'لعبة'}</td>
            <td><a href="${item.link}" target="_blank">تحميل</a></td>
            <td>
              <button class="action-btn edit-btn" onclick="editApp('${id}')">تعديل</button>
              <button class="action-btn" onclick="deleteApp('${id}')">حذف</button>
            </td>
          `;
          appsTableBody.appendChild(tr);
        });
      }
    });
  }

  // إضافة / تحديث التطبيق
  form.addEventListener("submit", e => {
    e.preventDefault();

    const id = document.getElementById("appId").value;
    const name = document.getElementById("name").value.trim();
    const image = document.getElementById("image").value.trim();
    const link = document.getElementById("link").value.trim();
    const type = document.getElementById("type").value;
    const details = document.getElementById("details").value.trim();

    if(!name || !image || !link || !type || !details) {
      alert("الرجاء ملء جميع الحقول");
      return;
    }

    const itemData = { name, image, link, type, details };

    if(id) {
      // تحديث
      db.ref('items/' + id).set(itemData);
      alert("تم تحديث التطبيق بنجاح");
    } else {
      // إضافة جديد
      const newKey = db.ref().child('items').push().key;
      db.ref('items/' + newKey).set(itemData);
      alert("تم إضافة التطبيق بنجاح");
    }

    form.reset();
    document.getElementById("appId").value = "";
  });

  // تعديل تطبيق
  function editApp(id) {
    db.ref('items/' + id).once('value').then(snapshot => {
      const data = snapshot.val();
      if(data) {
        document.getElementById("appId").value = id;
        document.getElementById("name").value = data.name;
        document.getElementById("image").value = data.image;
        document.getElementById("link").value = data.link;
        document.getElementById("type").value = data.type;
        document.getElementById("details").value = data.details;
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });
  }

  // حذف تطبيق
  function deleteApp(id) {
    if(confirm("هل أنت متأكد من حذف هذا التطبيق؟")) {
      db.ref('items/' + id).remove();
    }
  }

  loadApps();
</script>

</body>
</html>
